<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Maverick,熊猫小A,Galileo,blog" />
    <meta name="generator" content="Maverick 1.1" />
    <meta name="template" content="Galileo" />
    <link rel="alternate" type="application/rss+xml" title="瞎折腾分享 &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="瞎折腾分享 &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fejich/fejich.github.io@gh-pages/assets/galileo-3f4dcc35c9.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fejich/fejich.github.io@gh-pages/assets/ExSearch/ExSearch-182e5a8868.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fejich/fejich.github.io@gh-pages/assets/katex.min.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700&display=swap">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/fejich/fejich.github.io@gh-pages/eaa9c365c98e5ea5e293b704f29d1bb7.json"
        }
    </script>
    
<title>unRAID 系统下虚拟机黑群辉硬盘无损扩容记录 - 瞎折腾分享</title>
<meta name="author" content="fejich" />
<meta name="description" content="原本只分配了 30G 虚拟硬盘容量，后期空间不够用所以有了这次扩容" />
<meta property="og:title" content="unRAID 系统下虚拟机黑群辉硬盘无损扩容记录 - 瞎折腾分享" />
<meta property="og:description" content="原本只分配了 30G 虚拟硬盘容量，后期空间不够用所以有了这次扩容" />
<meta property="og:site_name" content="瞎折腾分享" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/qemu-img_resize/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2021-09-07T15:20:00-00.00" />
<meta name="twitter:title" content="unRAID 系统下虚拟机黑群辉硬盘无损扩容记录 - 瞎折腾分享" />
<meta name="twitter:description" content="原本只分配了 30G 虚拟硬盘容量，后期空间不够用所以有了这次扩容" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />

    </head>
    
    <body>
        
        <div class="container">
            <header id="ga-header">
                <div first>
                    <aside id="ga-brand">
                        <h1 class="brand"><a class="no-style" href="/">瞎折腾分享</a></h1>
                        <p>记录分享一些使用经验</p>
                    </aside>
                </div>
                <div second id="ga-nav">
                    <nav class="navs">
                        <ul><li><a class="ga-highlight" href="/" target="_self">首页</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/archives/" target="_self">归档</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/about/" target="_self">关于</a></li><span class="separator">·</span><li><a href="#" target="_self" class="search-form-input ga-highlight">搜索</a></li></ul>
                    </nav>
                </div>
            </header>
            <div class="wrapper">
                
<main>    
    <section class="ga-section ga-content">
        <article class="yue">
            <h1 class="ga-post_title">unRAID 系统下虚拟机黑群辉硬盘无损扩容记录</h1>
            <span class="ga-post_meta ga-mono">
                <span>fejich</span>
                <time>
                    2021-09-07
                </time>
                
                in <a no-style class="category" href="/category/默认分类/">
                    默认分类
                </a>
                
                
            </span>
            <div class="ga-content_body">
                <h1>0）测试环境</h1>
<p>黑群辉DSM 6.1.X，Basic 磁盘，btrfs 分区格式
虚拟硬盘为 img 格式，原始容量 30G</p>
<h1>1）调整虚拟硬盘容量</h1>
<p>务必虚拟机关机情况下再操作</p>
<p><code>qemu-img resize 30G.img -- +70G</code></p>
<blockquote><p>使用 qemu-img 命令给虚拟硬盘增加 70G 容量</p>
</blockquote>
<h1>2）使用 fdisk 无损扩容</h1>
<p><code>fdisk 30G.img</code></p>
<blockquote><p>具体操作记录，注意看 #号后面的中文注解
```shell
Welcome to fdisk (util-linux 2.34).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.</p>
</blockquote>
<p>Command (m for help): p #查看硬盘信息
Disk vdisk2.img: 100 GiB, 107374182400 bytes, 209715200 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xed294359</p>
<p>Device      Boot   Start      End  Sectors  Size Id Type
vdisk2.img1         2048  4982527  4980480  2.4G fd Linux raid autodetect
vdisk2.img2      4982528  9176831  4194304    2G fd Linux raid autodetect
vdisk2.img3      9437184 62709759 53272576 25.4G fd Linux raid autodetect  #记录下第三分区的开始位置 9437184，后边要用到</p>
<p>Command (m for help): d #首先删掉分区
Partition number (1-3, default 3):</p>
<p>Partition 3 has been deleted.</p>
<p>Command (m for help): n #然后新建一个，按默认选主分区跟编号即可
Partition type
   p   primary (2 primary, 0 extended, 2 free)
   e   extended (container for logical partitions)
Select (default p):</p>
<p>Using default response p.
Partition number (3,4, default 3): 
First sector (9176832-209715199, default 9177088): 9437184 #这里是无损扩容的关键，必须不能填错
Last sector, +/-sectors or +/-size{K,M,G,T,P} (9437184-209715199, default 209715199):</p>
<p>Created a new partition 3 of type 'Linux' and of size 95.5 GiB.
Partition #3 contains a linux_raid_member signature.</p>
<p>Do you want to remove the signature? [Y]es/[N]o: n # 必须选 N ，不要移除签名</p>
<p>Command (m for help): p #再次查看信息已经看到分区是扩容状态</p>
<p>Disk vdisk2.img: 100 GiB, 107374182400 bytes, 209715200 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xed294359</p>
<p>Device      Boot   Start       End   Sectors  Size Id Type
vdisk2.img1         2048   4982527   4980480  2.4G fd Linux raid autodetect
vdisk2.img2      4982528   9176831   4194304    2G fd Linux raid autodetect
vdisk2.img3      9437184 209715199 200278016 95.5G 83 Linux</p>
<p>Command (m for help): w #最后按 w 保存分区表
The partition table has been altered.
Syncing disks.
```</p>
<h1>3）打开虚拟机，使用 存储空间管理员 扩容即可</h1>
<p>点 <code>管理</code>，按提示操作</p>
<p><figure style="flex: 74.33628318584071" ><img width="1008" height="678" src="https://raw.githubusercontent.com/fejich/fejich.github.io/source/src/images/%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4%E7%AE%A1%E7%90%86%E5%91%98.png" /><figcaption>存储空间管理员</figcaption></figure></p>

            </div>
        </article>
        <div id="ga-tags">
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/tag/unRAID/">#unRAID</a>
    </span>
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/tag/NAS/">#NAS</a>
    </span>
    
</div>
    </section>

    
<section id="ga-content_pager">

    <div class="next">
        <h3>没有了</h3>
        <p class="yue">这是最新的文章</p>
    </div>


    <div class="prev">
        <a class="ga-highlight" href="/archives/my-first-awesome-post/">我的第一篇文章</a>
        <p class="yue">Hello World!</p>
    </div>

</section>


    
        <script>
            var initValine = function () {
                new Valine({"enable": true, "el": "#vcomments", "appId": "lslkachJjiWR2FD0NiAxSuHH-gzGzoHsz", "appKey": "8YljktyttMGfrlKNHCDV3DPF"});
            }
        </script>
        <script defer src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js' onload="initValine()"></script>
        <div id="vcomments"></div>
    

</main>

                <footer class="ga-mono" id="ga-footer">
                    <section>
                        <span id="ga-uptime"></span>
                        <span class="brand">瞎折腾分享</span>
                    </section>
                    <section>
                        <p class="copyright">
                            <span>Copyright © 2021 fejich</span>
                            <span>Powered by <a no-style href="https://github.com/AlanDecode/Maverick" target="_blank">Maverick & Galileo</a></span>
                        </p>
                        <div class="copyright">
                            <span class="footer-addon">
                                
                            </span>
                            <nav class="social-links">
                                <ul><li><a class="no-style" title="Twitter" href="https://twitter.com/AlanDecode" target="_blank"><i class="gi gi-twitter"></i>Twitter</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/AlanDecode" target="_blank"><i class="gi gi-github"></i>GitHub</a></li><span class="separator">·</span><li><a class="no-style" title="Weibo" href="https://weibo.com/5245109677/" target="_blank"><i class="gi gi-weibo"></i>Weibo</a></li></ul>
                            </nav>
                        </div>
                    </section>
                    <script>
                        var site_build_date = "2019-12-18T16:51+08:00"
                    </script>
                    <script src="https://cdn.jsdelivr.net/gh/fejich/fejich.github.io@gh-pages/assets/galileo-dc4baa7cf4.js"></script>
                </footer>
            </div>
        </div>
    </div>

    <!--katex-->
    <script defer src="https://cdn.jsdelivr.net/gh/fejich/fejich.github.io@gh-pages/assets/katex.min.js"></script>
    <script>
    mathOpts = {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "\\[", right: "\\]", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\(", right: "\\)", display: false}
        ]
    };
    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/fejich/fejich.github.io@gh-pages/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    <script src="https://cdn.jsdelivr.net/gh/fejich/fejich.github.io@gh-pages/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/fejich/fejich.github.io@gh-pages/assets/ExSearch/ExSearch-493cb9cd89.js"></script>

    
    </body>
</html>